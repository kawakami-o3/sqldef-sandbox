language: go
go:
- '1.10'
branches:
  only:
  - master
  - "/\\Av\\d+\\.\\d+\\.\\d+\\z/"
services:
- mysql
- postgresql
addons:
  apt:
    sources:
    - mysql-5.7-trusty
    packages:
    - mysql-server
    - mysql-client
before_install:
- sudo mysql -e "use mysql; update user set authentication_string=PASSWORD('new_password')
  where User='root'; update user set plugin='mysql_native_password';FLUSH PRIVILEGES;"
- sudo mysql_upgrade -u root -pnew_password
- sudo service mysql restart
- sudo mysqladmin -u root -pnew_password password ''
script:
- make test
before_deploy:
- make package
deploy:
  provider: releases
  api_key:
    secure: X5BrZc79tC2GjWlb6r3OOpBtxlIEXmqnsNbZr4XeS4XfhbdwBcpmLAo7yfp81rVwmdMyFjxMopzJIm8Ub8grxMwl+Shd2AFvNH7/ZveUbEBexGQweZP2lTqKqc1b3pfcEXckuw6EfEdvwPKccIPlVZQqhO7cDjbHMRfstRHAQaKR8KCWlB9Bwx+uRm1vg+cYYQhvGeCS34NedjefdZN52yimPv5laO1vIJ8JDnfcwzrSWLBprCZ6m2ooQcrfyKzKWkn0tpQpvFUv8UsnnI7bmChYK2QGWc43P6w83X77UU+53+THjQvihGZkmFDJva44So6W/aiZpAsk38J+dEOSA+gHgDpPhta1ox8hkk67wEgxjTL0UB60aI7yfDZ/yQ4Klf0Ifs4H5ToA76IMTdfOozC7bTVb+gybU40tMiPcNUbAoA2RQunm45Q4yZY1hwkmKW6Wesf+NwWpt0MgECsxi6fX/ft+SVNG73wN0VD3v3myei4qt9LEdNcXLqreHczIotlNg1mNDZLwppy7r5br/3yjo3ibq9Rs+FwlHptFAfRQ4a2AU157N7kY+dMHSIjh8aCoRwjS629u4d45MbfCXaU0ojJkDdJl9TaKe57JRmbgNWROYLOn37n2RVqHRv5OAZYv54f5RwK/Av7tVsbV+9bjK6+EDnQZ8Fe6IF733rI=
  file_glob: true
  file: package/*
  skip_cleanup: true
  on:
    repo: kawakami-o3/sqldef-sandbox
